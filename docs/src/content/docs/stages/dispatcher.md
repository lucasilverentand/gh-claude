---
title: Dispatcher Stage
slug: stages/dispatcher
description: Centralized event routing to agent workflows
sidebar:
  label: 1. Dispatcher
---

The dispatcher is a centralized workflow that listens to all GitHub events and routes them to the appropriate agent workflows. It's required for any agent with event-based triggers (issues, PRs, discussions, etc.).

## Purpose

- Aggregate triggers from all agents into a single entry point
- Validate configuration before dispatching
- Prepare shared event context
- Route events to matching agents
- Enable parallel agent execution via matrix strategy

## When It Runs

The dispatcher runs for **all event-based triggers**:
- Issue events (opened, labeled, etc.)
- Pull request events (opened, synchronize, etc.)
- Discussion events
- Scheduled events (cron)
- Repository dispatch events
- Manual workflow dispatch

## Jobs

### 1. Pre-Flight Check

Validates that required secrets are configured:
- Checks for `ANTHROPIC_API_KEY` or `CLAUDE_CODE_OAUTH_TOKEN`
- Creates a GitHub issue and disables the workflow if misconfigured
- Generates GitHub App token if configured

### 2. Prepare Context

Builds a shared context object with event data:
- Dispatch metadata (ID, timestamp, run URL)
- Event type and action
- Event-specific data (issue details, PR details, etc.)
- Uploads context as an artifact for agent workflows

### 3. Route Event

Matches the event against a routing table:
- Each agent defines which events it handles
- Multiple agents can match the same event
- Manual dispatch can target a specific agent by name

### 4. Dispatch Agents

Triggers matching agent workflows:
- Uses matrix strategy for parallel execution
- Passes context run ID to agent workflows
- Each agent runs independently

## Generated Workflow

The dispatcher workflow is generated by `repo-agents compile` and aggregates:
- All triggers from all agent definitions
- Permissions from all agents (union of requirements)
- A routing table mapping events to agent workflow files

```yaml
name: Claude Agent Dispatcher
on:
  issues:
    types: [opened, labeled]  # Union of all agent triggers
  pull_request:
    types: [opened, synchronize]
  schedule:
    - cron: '0 9 * * 1-5'
  workflow_dispatch:
    inputs:
      agent:
        description: 'Specific agent to run'
        required: false
```
